# 第一章 扩散模型简介
## 视频课程学习笔记1
### 1 提示词工程（Prompt Engineering）-AI编程新范式
#### ① 什么是提示词工程？
定义：提示工程（Prompt Engineering）是一门较新的学科，关注利用自然语言（自然语言俗称人类用的语言）的方式对大模型进行控制和交互的工程。是新兴的计算机工程（个人想法）。
#### ② 语言模型和大语言模型有什么区别？
语言模型（Language Model）是一种对自然语言的概率分布建模，目的是预测一段文本中下一个单词或字符的出现概率。它可以通过统计方法或深度学习技术来实现。早期的语言模型主要基于 n-gram 模型和马尔可夫模型。 大语言模型（Large Language Model）是指一种基于深度学习技术构建的自然语言处理模型，它可以接收文本作为输入并预测文本中缺失的部分。大语言模型通常是由大量文本数据训练得到的，例如互联网上的新闻、博客、维基百科等。这些模型可以生成自然语言文本、回答自然语言问题、进行机器翻译、语音识别等任务，被广泛应用于语言处理领域。 大语言模型是一种更先进的语言模型，它通过扩大预训练模型的参数量和数据量，在效果上显著提升，具备更强的上下文学习能力和逐步推理能力。大语言模型可以用于多种应用领域，如自然语言处理、机器翻译、语音识别等。而传统的小型语言模型通常用于较小的应用场景，如拼写检查、词性标注等。
#### ③ prompt的设计原则
越好的prompt，越具有更高的具体信息性。
#### ④ 什么是chain-of-Thought Prompting(思维链)？
思维链 (Chain-of-Thought Prompting) 是一种提示方法，它要求用户在生成文本时按照一定的逻辑顺序逐步提供信息，从而引导模型生成更加连贯、有条理的文本。思维链可以通过一系列问题或提示来引导用户思考和表达，从而帮助用户更好地组织思维和语言表达。 例如，如果要生成一篇关于某个主题的文章，思维链可以按照以下顺序逐步提供信息： 主题是什么？ 主题的重要性和背景是什么？ 主题的历史和现状是什么？ 主题的未来的发展趋势和展望是什么？ 通过这种方法，用户可以逐步深入地思考和探讨主题，从而生成更加全面、有条理的文本。思维链提示法可以用于各种文本生成任务，例如机器翻译、文本摘要、对话系统等，帮助模型生成更加准确、连贯、自然的文本。
#### ⑤ Prompt需要研究的问题？
SUMMARY
Excel
QA
INFERENCE
GENERATE
CLASSLFY
#### ⑥ Prompt可能产生的问题？
风险注入
提示泄露
模型偏见
越狱
虚构事实

----
## 书本学习笔记
### 1.1 扩散模型的原理

扩散模型是一类生成模型，运用物理热力学中的扩散思想，主要包括前向扩散和反向扩散。

> 生成模型：给定一批训练数据$X$，假设其服从某种复杂的真实分布$p(x)$，则给定的训练数据可视为从该分布中采样的观测样本$x$，其作用就是估计训练数据的真实分布。

>扩散的思想：来自于物理学中的非平衡热力学分支，例如墨水在水中扩散的实验，非平衡热力学可以描述这滴墨水随时间推移的扩散过程中每一个“时间步”状态的概率分布。

>DDPM(Denoising Diffusion Probabilistic Model)的扩散过程：
- 前向过程（数据噪声化）：在每个时间步$t$，给上一个时间步$t-1$的数据$x_{t-1}$添加高斯噪声，生成带有噪声的数据$x_t$，噪声的方差由$\beta_t$确定，均值由$\beta_t$和当前时刻“带噪”的数据分布确定。
加噪过程：$$q(x_t | x_{t-1}) = \mathcal{N} (x_t ; \sqrt{1 - \beta_t} x_{t - 1}, \beta_t I)$$
最终噪声分布的公式：
$$
q(x_{1:T} | x_0) = \prod_{t = 1}^T q(x_t | x_{t - 1})
$$

- 反向过程（数据去噪化）：从采样自高斯噪声$x \sim \mathcal{N}(0, I)$的随机噪声中恢复出原始数据$x_0$，通过由一系列用神经网络参数化的高斯分布组成的马尔可夫链进行数据去噪。

    从时间步$t$到时间步$t - 1$的单步反向“去噪”过程：
$$
q(x_{t - 1} | x_t, x_0) = \mathcal{N} (x_{t - 1}; \tilde{\mu}(x_t, x_0), \tilde{\beta_t} I)    
$$
&emsp;&emsp;其中，均值为
$$
\tilde{\beta_t} = \frac{ 1 - \bar{\alpha}_{t - 1}}{ 1 - \bar{\alpha}_t} \cdot \beta_t
$$
&emsp;&emsp;方差为
$$
\tilde{\mu}(x_t, x_0) = \frac{\sqrt{\alpha_t} (1 - \bar{\alpha}_{t - 1})}{1 - \bar{\alpha}_t} x_t + \frac{ \sqrt{ \bar{\alpha}_{t - 1} } \beta_t }{1 - \bar{\alpha}_t} x_0   
$$

>优化目标：要求反向过程中预测的噪声分布与前向过程中施加的噪声分布之间的“距离”最小。

    优化目标公式：
$$
L_{t - 1}^{\text{simple}} = \mathbb{E}_{x_0, \epsilon \sim \mathcal{N}(0, I)} \left[ \| \epsilon - \epsilon_{\theta} \left( \sqrt{\bar{\alpha}_t} x_0 + \sqrt{1 - \bar{\alpha}_t} \epsilon, t \right) \|^2  \right]    
$$